test_dt
library(ggplot2)
library(data.table)
test_dt <- fread("/juno/work/greenbaum/users/ahunos/apps/methyl_longRead_wf/results/build_consensus/consensus_HighQual_motif_sites.tsv")
test_dt
plt_h <- ggplot(test_dt, aes(x=AVG)) + geom_histogram(binwidth = 1) + labs("Average #Consensus reads per motif site")
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
dt_AvgReads <- copy(test_dt)[,list(Counts=.N, Mean=mean(AVG), Max=max(AVG), Min=min(AVG), 
                      Median=as.numeric(median(AVG)), Std=sd(AVG))]
dt_AvgReads
geom_text_size = 3
dt_AvgReads
plt_h <- ggplot(test_dt, aes(x=AVG)) + 
  geom_histogram(binwidth = 1) + 
  labs("Average #Consensus reads per motif site")+
                                        geom_text(x = 3000, y = 1700, 
                                        aes(label = paste0("\nCounts: ", Counts,
                                        "\nRange: ", Min, "-", Max,
                                        "\nmean: ", Mean, 
                                      "\nmedian: ", Median,
                                      "\nSD: ", Std)), 
                              data = dt_AvgReads, size=geom_text_size) 
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
plt_h <- ggplot(test_dt, aes(x=AVG)) + 
  geom_histogram(binwidth = 1) + 
  labs("Average #Consensus reads per motif site")+
                                        geom_text(x = 1500, y = 3000, 
                                        aes(label = paste0("\nCounts: ", Counts,
                                        "\nRange: ", Min, "-", Max,
                                        "\nmean: ", Mean, 
                                      "\nmedian: ", Median,
                                      "\nSD: ", Std)), 
                              data = dt_AvgReads, size=geom_text_size) 
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
log()
log(3000)
plt_h <- ggplot(test_dt, aes(x=AVG)) + 
  geom_histogram(binwidth = 1) + 
  labs("Average #Consensus reads per motif site")+
                                        geom_text(x = 8, y = 3000, 
                                        aes(label = paste0("\nCounts: ", Counts,
                                        "\nRange: ", Min, "-", Max,
                                        "\nmean: ", Mean, 
                                      "\nmedian: ", Median,
                                      "\nSD: ", Std)), 
                              data = dt_AvgReads, size=geom_text_size) +
                              scale_x_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
                  labels = scales::trans_format("log10", scales::math_format(expr = 10^.x)))
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
plt_h <- ggplot(test_dt, aes(x=AVG)) + 
  geom_histogram() + 
  labs("Average #Consensus reads per motif site")+
                                        geom_text(x = 8, y = 3000, 
                                        aes(label = paste0("\nCounts: ", Counts,
                                        "\nRange: ", Min, "-", Max,
                                        "\nmean: ", Mean, 
                                      "\nmedian: ", Median,
                                      "\nSD: ", Std)), 
                              data = dt_AvgReads, size=geom_text_size) +
                              scale_x_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
                  labels = scales::trans_format("log10", scales::math_format(expr = 10^.x)))
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
plt_h <- ggplot(test_dt, aes(x=AVG)) + 
  geom_histogram() + 
  labs("Average #Consensus reads per motif site")+
                                        geom_text(x = 1500, y = 3000, 
                                        aes(label = paste0("\nCounts: ", Counts,
                                        "\nRange: ", Min, "-", Max,
                                        "\nmean: ", Mean, 
                                      "\nmedian: ", Median,
                                      "\nSD: ", Std)), 
                              data = dt_AvgReads, size=geom_text_size) #+
                  #             scale_x_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
                  # labels = scales::trans_format("log10", scales::math_format(expr = 10^.x)))
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
plt_h <- ggplot(test_dt, aes(x=AVG)) + 
  geom_histogram() + 
  labs("Average #Consensus reads per motif site")+
                                        geom_text(x = 3, y = 3000, 
                                        aes(label = paste0("\nCounts: ", Counts,
                                        "\nRange: ", Min, "-", Max,
                                        "\nmean: ", Mean, 
                                      "\nmedian: ", Median,
                                      "\nSD: ", Std)), 
                              data = dt_AvgReads, size=geom_text_size) +
                              scale_x_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
                  labels = scales::trans_format("log10", scales::math_format(expr = 10^.x)))
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
plt_h <- ggplot(test_dt, aes(x=AVG)) + 
  geom_histogram() + 
  labs("Average #Consensus reads per motif site")+
                                        geom_text(x = 2, y = 3000, 
                                        aes(label = paste0("\nCounts: ", Counts,
                                        "\nRange: ", Min, "-", Max,
                                        "\nmean: ", Mean, 
                                      "\nmedian: ", Median,
                                      "\nSD: ", Std)), 
                              data = dt_AvgReads, size=geom_text_size) +
                              scale_x_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
                  labels = scales::trans_format("log10", scales::math_format(expr = 10^.x)))
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
1.0e+07plt_h <- ggplot(test_dt, aes(x=AVG)) + 
  geom_histogram() + 
  labs("Average #Consensus reads per motif site")+
                                        geom_text(x = 2, y = 1.0e+07, 
                                        aes(label = paste0("\nCounts: ", Counts,
                                        "\nRange: ", Min, "-", Max,
                                        "\nmean: ", Mean, 
                                      "\nmedian: ", Median,
                                      "\nSD: ", Std)), 
                              data = dt_AvgReads, size=geom_text_size) +
                              scale_x_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
                  labels = scales::trans_format("log10", scales::math_format(expr = 10^.x)))
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
plt_h <- ggplot(test_dt, aes(x=AVG)) + 
  geom_histogram() + 
  labs("Average #Consensus reads per motif site")+
                                        geom_text(x = 2, y = 1.0e+07, 
                                        aes(label = paste0("\nCounts: ", Counts,
                                        "\nRange: ", Min, "-", Max,
                                        "\nmean: ", Mean, 
                                      "\nmedian: ", Median,
                                      "\nSD: ", Std)), 
                              data = dt_AvgReads, size=geom_text_size) +
                              scale_x_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
                  labels = scales::trans_format("log10", scales::math_format(expr = 10^.x)))
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
plt_h <- ggplot(test_dt, aes(x=AVG)) + 
  geom_histogram() + 
  labs(title = "Average #Consensus reads per motif site")+
                                        geom_text(x = 2, y = 1.0e+07, 
                                        aes(label = paste0("\nCounts: ", Counts,
                                        "\nRange: ", Min, "-", Max,
                                        "\nmean: ", Mean, 
                                      "\nmedian: ", Median,
                                      "\nSD: ", Std)), 
                              data = dt_AvgReads, size=geom_text_size) +
                              scale_x_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
                  labels = scales::trans_format("log10", scales::math_format(expr = 10^.x)))
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
plt_h <- ggplot(test_dt, aes(x=AVG)) + 
  geom_histogram(bins=50) + 
  labs(title = "Average #Consensus reads per motif site")+
                                        geom_text(x = 2, y = 1.0e+07, 
                                        aes(label = paste0("\nCounts: ", Counts,
                                        "\nRange: ", Min, "-", Max,
                                        "\nmean: ", Mean, 
                                      "\nmedian: ", Median,
                                      "\nSD: ", Std)), 
                              data = dt_AvgReads, size=geom_text_size) +
                              scale_x_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
                  labels = scales::trans_format("log10", scales::math_format(expr = 10^.x)))
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
plt_h <- ggplot(test_dt, aes(x=AVG)) + 
  geom_histogram(bins=50) + 
  labs(title = "Average #Consensus reads per motif site")+
                                        geom_text(x = 2, y = 6.0e+06, 
                                        aes(label = paste0("\nCounts: ", Counts,
                                        "\nRange: ", Min, "-", Max,
                                        "\nmean: ", Mean, 
                                      "\nmedian: ", Median,
                                      "\nSD: ", Std)), 
                              data = dt_AvgReads, size=geom_text_size) +
                              scale_x_log10(breaks = scales::trans_breaks("log10", function(x) 10^x),
                  labels = scales::trans_format("log10", scales::math_format(expr = 10^.x)))
ggsave("hist_Avg_Consensus_Reads_per_site.tiff", plot = plt_h, width=300, height=225, units="mm", dpi=300, compression = "lzw")
rowMedians
rowMedian
library(matrixStats)
rowMedians
dt_AvgReads
test_dt
names(test_dt2)  
names(test_dt)
str_detect(names(test_dt), "sample")
names(test_dt)[str_detect(names(test_dt), "sample")]
names(test_dt)[str_detect(names(test_dt), "strand")]
names(test_dt)[!str_detect(names(test_dt), "strand")]
paste0(c("strand", "chrom","end"), collapse = "|")
omit_col <- paste0(c("strand", "chrom","end"), collapse = "|")
names(test_dt)[!str_detect(names(test_dt), omit_col)]
omit_col <- paste0(c("strand", "chrom","end", "SUM","AVG", "MIN", "MED"), collapse = "|")
names(test_dt)[!str_detect(names(test_dt), omit_col)]
test_dt
test_dt2 <- melt(test_dt[sample(.N,100)], id.vars = c("chrom","end","strand",),
                measure.vars = names(test_dt)[!str_detect(names(test_dt), omit_col)])
test_dt2 <- melt(test_dt[sample(.N,100)], id.vars = c("chrom","end","strand"),
                measure.vars = names(test_dt)[!str_detect(names(test_dt), omit_col)])
test_dt2
test_dt2 <- melt(test_dt[sample(.N,100)], id.vars = c("chrom","end","strand"),
                measure.vars = names(test_dt)[!str_detect(names(test_dt), omit_col)],
                variable.name = "samples", value.name = "Nvalid_cov")
test_dt2
test_dt2 <- melt(test_dt, id.vars = c("chrom","pos","strand"),
                measure.vars = names(test_dt)[!str_detect(names(test_dt), omit_col)],
                variable.name = "samples", value.name = "Nvalid_cov")
test_dt
omit_col <- paste0(c("chrom","end","strand", "SUM","AVG", "MIN", "MED"), collapse = "|")
#melt data.table
test_dt2 <- melt(test_dt, id.vars = c("chrom","end","strand"),
                measure.vars = names(test_dt)[!str_detect(names(test_dt), omit_col)],
                variable.name = "samples", value.name = "Nvalid_cov")
test_dt2
